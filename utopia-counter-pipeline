node {
   stage("Code Check out"){
		git 'https://github.com/derekhcchou/UtopiaAirline_Counter.git'
   }
   
   stage("Compile-Package"){
       sh script: 'mvn clean install'
	   
   }
   
  
   stage ("SonarQube-Analysys"){
        withSonarQubeEnv("sonorQube"){
            
             sh script: 'mvn sonar:sonar'
        }
   }  
   
   
   stage("Build-Docker-Image"){
      
	   sh script: 'sudo docker build -t travel-counter -f DockerfileCounter .'
	   
	   sh script: 'docker tag travel-counter:latest 443611426531.dkr.ecr.us-east-1.amazonaws.com/travel-counter:latest'
	   
	    
   }
   
  
   
   
   
   
   
   
   
   stage("Push-Docker-Image"){
   
   withAWS(region:'us-east-1',credentials:'aws-credentials') {

                docker.withRegistry("443611426531.dkr.ecr.us-east-1.amazonaws.com", "ecr.us-east-1:travel-counter") {
    
			
			docker.image("travel-counter:latest").push()
		}

                
		}

   
   
		
	}   
   
  
}


